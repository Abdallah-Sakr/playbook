---
- name: deploy httpd on port 8080
  hosts: all
  become: yes
  tasks:
    - name: install httpd service
      ansible.builtin.yum:
        name: httpd
        state: present

    - name: change httpd listen port to 8080
      ansible.builtin.lineinfile:
        path: /etc/httpd/conf/httpd.conf
        regexp: '^Listen '
        line: 'Listen 8080'
        backup: yes

    - name: enable and start httpd service
      ansible.builtin.service:
        name: httpd
        state: started
        enabled: yes

    - name: open port 8080 in firewalld
      ansible.posix.firewalld:
        port: 8080/tcp
        permanent: yes
        immediate: yes
        state: enabled
